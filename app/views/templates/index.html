{% extends "base.html" %}
{% block title %}{% if title_q %}{{ title_q|capitalize }} Jobs{% if country_q %} in {{ country_q }}{% endif %} | Catalitium{% else %}Find Tech Jobs & Salary Insights | Catalitium{% endif %}{% endblock %}

{% block meta %}
<meta name="description" content="{% if title_q %}{{ title_q|capitalize }} jobs{% if country_q %} in {{ country_q }}{% endif %} with real salary data.{% else %}Search curated tech jobs with verified salary insights. Find your next role in AI, Development, Engineering across US, EU, UK & remote positions.{% endif %}">
<meta name="keywords" content="tech jobs, developer jobs, software engineer, remote work, {{ title_q if title_q else 'technology' }}, {{ country_q if country_q else 'remote jobs' }}">
<link rel="canonical" href="{{ url_for('index', _external=True) }}">
<!-- Open Graph tags -->
<meta property="og:title" content="{% if title_q %}{{ title_q|capitalize }} Jobs{% if country_q %} in {{ country_q }}{% endif %} | Catalitium{% else %}Find Tech Jobs & Salary Insights | Catalitium{% endif %}">
<meta property="og:description" content="{% if title_q %}Browse {{ title_q|capitalize }} jobs with real salary data{% else %}Search tech jobs with verified salary insights{% endif %}">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ url_for('index', _external=True) }}">
<!-- Twitter Card tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{% if title_q %}{{ title_q|capitalize }} Jobs{% if country_q %} in {{ country_q }}{% endif %}{% else %}Tech Jobs & Salary Insights{% endif %}">
<meta name="twitter:description" content="{% if title_q %}Browse {{ title_q|capitalize }} jobs with real salary data{% else %}Search tech jobs with verified salary insights{% endif %}">
{% if pagination %}
  {% if pagination.prev_url %}<link rel="prev" href="{{ pagination.prev_url }}">{% endif %}
  {% if pagination.next_url %}<link rel="next" href="{{ pagination.next_url }}">{% endif %}
{% endif %}
{% endblock %}

{% block content %}
<!-- HERO -->
<section class="pt-6 sm:pt-10" role="region" aria-labelledby="jobs-hero">
  <div class="mx-auto max-w-4xl text-center">
      <h1 id="jobs-hero" class="text-3xl sm:text-4xl font-semibold tracking-tight">
        {% if title_q %}
          {{ title_q|capitalize }} Jobs {% if country_q %}in {{ country_q }}{% endif %}
        {% else %}
          <a href="{{ url_for('recruiter_salary_board') }}" class="text-inherit no-underline hover:text-brand transition-colors">See Jobs and Salary information</a>
        {% endif %}
      </h1>
      <p class="mt-3 text-slate-600">
        {% if title_q %}
          Browse {{ count|default(0) }} curated roles with transparent salary cues so you don't have to open ten tabs to compare offers.
        {% else %}
          We clean noisy job feeds, normalize titles and locations, and add salary ranges so engineers and product people can scan the market in minutes.
        {% endif %}
      </p>
    {% if title_q and count > 0 %}
    <div class="mt-2 text-sm text-slate-500">
      Updated {{ "2025-11-02"|datetime|timeago }}
    </div>
    {% endif %}
    {% if not title_q %}
    <div class="mt-4">
      <a href="#"
         data-open-subscribe="hero"
         class="inline-flex items-center gap-1.5 text-sm text-brand font-medium hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/50 rounded">
        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M22 6l-10 7L2 6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
        Get a weekly digest of curated roles + salary data
      </a>
    </div>
    {% endif %}
  </div>

  <!-- SEARCH: What / Where -->
  <div class="mx-auto mt-6 max-w-4xl px-3 sm:px-0">
    <div class="sticky top-14 z-40 rounded-xl border border-slate-200 bg-white/95 backdrop-blur shadow-sm supports-[backdrop-filter]:bg-white/70 sm:static sm:border-transparent sm:bg-transparent sm:shadow-none">
      <form id="search"
            action="{{ url_for('index') }}"
            method="get"
            aria-label="Job search"
            role="search"
            aria-describedby="search-help"
            class="grid grid-cols-1 sm:grid-cols-[1fr_240px_auto] gap-2 sm:gap-3 p-3 sm:p-0"
            data-results-count="{{ count|default(0) }}">
        <p id="search-help" class="sr-only">Search jobs by title and country.</p>

        <label for="q" class="sr-only">Job title or keywords</label>
        <div class="relative" id="q-wrap">
        <input id="q"
               name="title"
               value="{{ title_q or '' }}"
               type="search"
               inputmode="search"
               autocapitalize="none"
               spellcheck="false"
               autocomplete="off"
               placeholder="Enter job title or salary (e.g. developer, >100k)"
               class="w-full rounded-xl border border-slate-300 px-4 py-3 text-base sm:text-sm focus:ring-2 focus:ring-brand/50 focus:outline-none shadow-sm">
        </div>

        <div id="loc-wrap" class="block">
          <label for="loc" class="sr-only">Country / region</label>
          <div class="relative">
            <input id="loc"
                   name="country"
                   value="{{ country_q or '' }}"
                   type="search"
                   inputmode="text"
                   autocapitalize="characters"
                   autocomplete="off"
                   placeholder="Location (e.g. US, EU, London)"
                   class="w-full rounded-xl border border-slate-300 px-4 py-3 text-base sm:text-sm focus:ring-2 focus:ring-brand/50 focus:outline-none shadow-sm">
          </div>
        </div>

        <button type="submit"
                class="rounded-xl bg-brand text-white px-5 py-3.5 sm:py-3 font-medium text-base sm:text-sm hover:opacity-90 hover:shadow-md focus:ring-2 focus:ring-brand/50 focus:outline-none active:transform active:translate-y-[1px] transition shadow-sm"
                aria-label="Search {% if title_q %}{{ title_q }} {% endif %}jobs{% if country_q %} in {{ country_q }}{% endif %}">
          Search Jobs
        </button>
      </form>
    </div>
  </div>

  <!-- META / FILTERS -->
  <div class="mx-auto max-w-4xl mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3 px-3 sm:px-0">
    {% set show_exact = (title_q or country_q) %}
    {% set rounded = ((count // 1000) * 1000) if count and count >= 1000 else count %}
    <div class="flex items-center gap-2 flex-wrap text-xs sm:text-sm">
      <span id="js-results-count" class="font-medium text-slate-700">
        {% if show_exact %}
          {{ count|default(0) }} curated results
        {% else %}
          {% if rounded and rounded >= 1000 %}
            +{{ rounded }} curated results
          {% else %}
            {{ count|default(0) }} curated results
          {% endif %}
        {% endif %}
      </span>

      {% if title_q or country_q %}
      <span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 border border-emerald-200 px-2 py-0.5 text-[11px] font-semibold text-emerald-800">
        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 7h16M9 12h6M11 17h2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Filters applied
      </span>
        {% if title_q %}
          <span class="inline-flex items-center gap-1 rounded-full bg-slate-50 px-2.5 py-1 border border-slate-200 text-slate-700">
            <svg class="w-3.5 h-3.5 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 7l-4 5 4 5M16 7l4 5-4 5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            title: {{ title_q }}
          </span>
        {% endif %}
        {% if country_q %}
          <span class="inline-flex items-center gap-1 rounded-full bg-slate-50 px-2.5 py-1 border border-slate-200 text-slate-700">
            <svg class="w-3.5 h-3.5 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 12c2.5-4 5.5-6 9-6s6.5 2 9 6c-2.5 4-5.5 6-9 6s-6.5-2-9-6z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 6c0 4 0 8 0 12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
            country: {{ country_q }}
          </span>
        {% endif %}
        <a class="ml-1 underline hover:text-brand" href="{{ url_for('index') }}">Clear</a>
      {% endif %}
    </div>

    <!-- Saved jobs button (hidden when 0 saves) -->
    <button id="saved-jobs-btn"
            type="button"
            class="hidden items-center gap-1.5 rounded-full border border-amber-300 bg-amber-50 px-3 py-1.5 text-xs font-semibold text-amber-800 hover:bg-amber-100 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/50"
            aria-expanded="false"
            aria-controls="saved-jobs-panel">
      <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M5 3h14a1 1 0 011 1v18l-7-4-7 4V4a1 1 0 011-1z"/></svg>
      Saved (<span id="saved-jobs-count">0</span>)
    </button>

    <!-- Subscribe toggle -->
    <label for="weekly-toggle" class="flex items-center gap-2 cursor-pointer select-none">
      <input id="weekly-toggle"
             type="checkbox"
             class="peer sr-only"
             aria-controls="subscribeDialog"
             aria-describedby="weekly-help">
      <span class="relative inline-flex h-5 w-9 items-center rounded-full bg-slate-300 peer-checked:bg-brand transition">
        <span class="absolute left-1 peer-checked:left-5 inline-block h-4 w-4 rounded-full bg-white shadow transition"></span>
      </span>
      <span class="text-slate-700">Get weekly high-match digest.</span>
    </label>
    <p id="weekly-help" class="sr-only">Opens the subscribe dialog so you can join the weekly newsletter.</p>
  </div>
  <div aria-live="polite" class="sr-only">
    {{ count|default(0) }} result{{ '' if count==1 else 's' }}
  </div>
</section>

<!-- Quick Filters -->
<div class="mx-auto max-w-4xl mt-3 sm:mt-4 px-3">
  <div class="flex items-center gap-2 mb-2 text-sm text-slate-600">
    <span class="inline-flex items-center gap-1 font-semibold text-slate-800">
      <svg class="w-4 h-4 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 7h16M7 12h10M10 17h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      Quick filters
    </span>
  </div>
  <div class="flex gap-2 sm:gap-3 overflow-x-auto no-scrollbar -mx-3 px-3 py-1.5 snap-x snap-mandatory touch-pan-x" role="listbox" aria-label="Quick filters">
    {% set t = (title_q or '') %}
    {% set c = (country_q or '') %}
    {% set base_chip = 'snap-start inline-flex items-center gap-1.5 rounded-full border px-3 py-1.5 text-sm font-medium transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none' %}
    {% set off_chip = 'bg-slate-50 border-slate-200 text-slate-700 hover:bg-slate-100' %}
    {% set on_chip = 'bg-[#1061DE] text-white border-[#1061DE]' %}
    <a role="button" aria-pressed="{{ 'true' if 'ai' in (t|lower) else 'false' }}" href="{{ url_for('index', title=(t ~ ' ai').strip(), country=c) }}"
       data-filter-chip="title" data-filter-value="ai"
       class="{{ base_chip }} {{ on_chip if 'ai' in (t|lower) else off_chip }}">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M5 6.5h3M5 11.5h6M5 16.5h9" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><circle cx="15" cy="6.5" r="1.4" fill="currentColor"/><circle cx="12" cy="11.5" r="1.4" fill="currentColor"/><circle cx="9" cy="16.5" r="1.4" fill="currentColor"/></svg>
      AI
    </a>
    <a role="button" aria-pressed="{{ 'true' if 'developer' in (t|lower) else 'false' }}" href="{{ url_for('index', title=(t ~ ' developer').strip(), country=c) }}" data-filter-chip="title" data-filter-value="developer"
       class="{{ base_chip }} {{ on_chip if 'developer' in (t|lower) else off_chip }}">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 7l-4 5 4 5M16 7l4 5-4 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Dev
    </a>
    <a role="button" aria-pressed="{{ 'true' if 'remote' in (t|lower) else 'false' }}" href="{{ url_for('index', title=(t ~ ' remote').strip(), country=c) }}" data-filter-chip="title" data-filter-value="remote"
       class="{{ base_chip }} {{ on_chip if 'remote' in (t|lower) else off_chip }}">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 9a8 8 0 0116 0v6a2 2 0 01-2 2h-3l-2 3-2-3H6a2 2 0 01-2-2V9z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round"/></svg>
      Remote
    </a>
    <a role="button" aria-pressed="{{ 'true' if 'senior' in (t|lower) else 'false' }}" href="{{ url_for('index', title=(t ~ ' senior').strip(), country=c) }}" data-filter-chip="title" data-filter-value="senior"
       class="{{ base_chip }} {{ on_chip if 'senior' in (t|lower) else off_chip }}">
      Senior
    </a>
    <a role="button" aria-pressed="{{ 'true' if '100k' in (t|lower) else 'false' }}" href="{{ url_for('index', title=(t ~ ' 100k').strip(), country=c) }}" data-filter-chip="title" data-filter-value=">100k"
       class="{{ base_chip }} {{ on_chip if '100k' in (t|lower) else off_chip }}">
      >100k
    </a>
    <a role="button" aria-pressed="{{ 'true' if c=='CH' else 'false' }}" href="{{ url_for('index', title=t, country='CH') }}" data-filter-chip="country" data-filter-value="CH"
       class="{{ base_chip }} {{ on_chip if c=='CH' else off_chip }}">
      CH
    </a>
    <a role="button" aria-pressed="{{ 'true' if c=='EU' else 'false' }}" href="{{ url_for('index', title=t, country='EU') }}" data-filter-chip="country" data-filter-value="EU"
       class="{{ base_chip }} {{ on_chip if c=='EU' else off_chip }}">
      EU
    </a>
    <a role="button" aria-pressed="{{ 'true' if c=='UK' else 'false' }}" href="{{ url_for('index', title=t, country='UK') }}" data-filter-chip="country" data-filter-value="UK"
       class="{{ base_chip }} {{ on_chip if c=='UK' else off_chip }}">
      UK
    </a>
    <a role="button" aria-pressed="{{ 'true' if c=='US' else 'false' }}" href="{{ url_for('index', title=t, country='US') }}" data-filter-chip="country" data-filter-value="US"
       class="{{ base_chip }} {{ on_chip if c=='US' else off_chip }}">
      US
    </a>
    <a role="button" aria-pressed="{{ 'true' if c=='IN' else 'false' }}" href="{{ url_for('index', title=t, country='IN') }}" data-filter-chip="country" data-filter-value="IN"
       class="{{ base_chip }} {{ on_chip if c=='IN' else off_chip }}">
      IN
    </a>
  </div>
  <div class="sr-only" aria-live="polite">Quick filters</div>
</div>

<!-- Category context (server-side, crawlable) — shown when a filter is active -->
{% if cat_ctx %}
<div class="mx-auto max-w-4xl mt-3 px-3 sm:px-0">
  <div class="rounded-xl border border-brand/20 bg-brand/5 px-4 py-3">
    <h2 class="text-sm font-semibold text-brand mb-0.5">{{ cat_ctx.headline }}</h2>
    <p class="text-sm text-slate-600 leading-relaxed">{{ cat_ctx.intro }}</p>
    <p class="text-xs text-slate-400 mt-1">{{ cat_ctx.salary_note | safe }}</p>
  </div>
</div>
{% endif %}

<!-- New Since Last Visit Banner (populated by JS) -->
<div id="new-since-banner" class="mx-auto max-w-4xl mt-3 px-3 sm:px-0 hidden">
  <div class="flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-2.5 text-sm text-emerald-800">
    <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    <span id="new-since-text"></span>
  </div>
</div>

<!-- Salary Explorer Widget -->
<section class="mx-auto max-w-4xl mt-4 px-3 sm:px-0" aria-label="Salary explorer">
  <details id="salary-explorer-details" class="group rounded-xl border border-slate-200 bg-white overflow-hidden">
    <summary class="flex items-center justify-between px-4 py-3 cursor-pointer text-sm font-semibold text-slate-800 hover:bg-slate-50 select-none list-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/50">
      <span class="flex items-center gap-2">
        <svg class="w-4 h-4 text-brand" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Salary Explorer
        <span class="text-xs font-normal text-slate-400">— what does the market pay?</span>
      </span>
      <svg class="w-4 h-4 transition-transform group-open:rotate-180 text-slate-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
    </summary>
    <div class="px-4 pb-4 pt-3 border-t border-slate-100">
      <div class="grid grid-cols-1 sm:grid-cols-[1fr_180px_auto] gap-2">
        <input id="salary-explorer-title" type="text"
               value="{{ title_q or '' }}"
               placeholder="Role (e.g. Senior Developer)"
               class="w-full rounded-xl border border-slate-300 px-4 py-2.5 text-sm focus:ring-2 focus:ring-brand/50 focus:outline-none">
        <input id="salary-explorer-country" type="text"
               value="{{ country_q or '' }}"
               placeholder="Country (e.g. US, DE)"
               class="w-full rounded-xl border border-slate-300 px-4 py-2.5 text-sm focus:ring-2 focus:ring-brand/50 focus:outline-none">
        <button id="salary-explorer-btn"
                type="button"
                class="rounded-xl bg-brand text-white px-5 py-2.5 text-sm font-medium hover:opacity-90 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/50">
          Explore
        </button>
      </div>
      <div id="salary-explorer-result" class="mt-4 hidden"></div>
    </div>
  </details>
</section>

<!-- Saved Jobs Panel -->
<section id="saved-jobs-panel"
         class="mx-auto max-w-4xl mt-3 px-3 sm:px-0 hidden"
         aria-label="Saved jobs"
         aria-live="polite">
  <div class="rounded-xl border border-amber-200 bg-amber-50 p-4">
    <h3 class="text-sm font-semibold text-amber-900 flex items-center gap-2 mb-3">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M5 3h14a1 1 0 011 1v18l-7-4-7 4V4a1 1 0 011-1z"/></svg>
      Saved Jobs
    </h3>
    <div id="saved-jobs-list"></div>
  </div>
</section>

<!-- RESULTS LIST -->
<section class="mx-auto max-w-4xl mt-6" aria-label="Job results">
  {% if country_q and country_q|lower == 'eu' and results and results|length < 3 %}
  <div class="mb-2 flex items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700">
    <svg class="w-4 h-4 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3c3 0 6 2 9 6-3 4-6 6-9 6s-6-2-9-6c3-4 6-6 9-6zM12 3v12M6 9h12" stroke="currentColor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/></svg>
    EU highlights: try Paris, Berlin, or Madrid to see more roles.
  </div>
  {% endif %}
  <div id="results" class="grid grid-cols-1 gap-3">
    {% if results and results|length > 0 %}
      {% for j in results %}
        {% set card_index = loop.index %}
        {% include 'components/job_card.html' %}
        {% if loop.index == 3 %}
          {% set promo_body -%}
            {% if title_q %}Curated {{ title_q }} roles + salary benchmarks in your inbox.{% else %}10 curated tech roles + salary data every week.{% endif %} <a href="#" class="underline font-semibold" data-open-subscribe="results_promo" data-subscribe-title="{{ title_q or '' }}" data-subscribe-country="{{ country_q or '' }}" data-subscribe-salary="{{ salary_band or '' }}">Subscribe free &rarr;</a>
          {%- endset %}
          {% with %}
            {% set params = {
              'eyebrow': 'Weekly Digest',
              'body': promo_body,
              'subcopy': 'One email/week · Unsubscribe anytime',
              'background_class': 'bg-brand/5',
              'border_class': 'border-brand/20',
              'text_class': 'text-slate-700'
            } %}
            {% include 'components/promo_card.html' with context %}
          {% endwith %}
        {% endif %}
        {% if loop.index == 7 %}
          {% set promo_body -%}
            Reach 10,000+ tech professionals actively browsing roles. <a href="#" class="underline font-semibold" data-open-job-posting>Post a job &rarr;</a>
          {%- endset %}
          {% with %}
            {% set params = {
              'eyebrow': 'Hiring?',
              'body': promo_body,
              'subcopy': 'From startups to scale-ups',
              'background_class': 'bg-amber-50',
              'border_class': 'border-amber-300/60',
              'text_class': 'text-amber-800'
            } %}
            {% include 'components/promo_card.html' with context %}
          {% endwith %}
        {% endif %}
      {% endfor %}
    {% else %}
      <div class="rounded-xl border border-slate-200 p-6 text-slate-600 text-center">
        <p class="font-medium">No jobs matched these filters yet.</p>
        <p class="text-xs mt-1">
          {% if country_q and country_q|lower == 'eu' %}
            Try nearby hubs like Paris, Berlin, or Madrid, or broaden to Remote/US/UK.
          {% elif country_q and country_q|lower in ['in','india'] %}
            Try major hubs like Bangalore, Mumbai, or Delhi, or broaden to Remote/SG.
          {% elif title_q and '100k' in title_q|lower %}
            Adjust the salary floor (for example ">80k") or pair it with a region like US/EU to expand results.
          {% else %}
            Try a broader keyword (for example "engineer") or remove the region filter to see more roles.
          {% endif %}
        </p>
        <div class="mt-4 pt-4 border-t border-slate-100">
          <p class="text-sm font-medium text-slate-700 mb-2">Get notified when these roles arrive.</p>
          <button type="button"
                  data-open-subscribe="empty_state"
                  data-subscribe-title="{{ title_q or '' }}"
                  data-subscribe-country="{{ country_q or '' }}"
                  class="inline-flex items-center gap-2 rounded-xl bg-brand text-white px-4 py-2 text-sm font-semibold hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/50 motion-safe:transition-opacity">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M22 6l-10 7L2 6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
            Get notified
          </button>
        </div>
      </div>
    {% endif %}
  </div>
  <!-- Skeletons shown during form submit navigation -->
  <div id="results-skeletons" class="mt-3 hidden">
    <div class="rounded-xl border border-slate-200 p-4 animate-pulse h-24 bg-slate-50"></div>
    <div class="rounded-xl border border-slate-200 p-4 animate-pulse h-24 bg-slate-50 mt-2"></div>
    <div class="rounded-xl border border-slate-200 p-4 animate-pulse h-24 bg-slate-50 mt-2"></div>
    <div class="rounded-xl border border-slate-200 p-4 animate-pulse h-24 bg-slate-50 mt-2"></div>
  </div>
</section>

<!-- Editorial value / trust signals -->
<section class="mx-auto max-w-4xl mt-6 px-3 sm:px-0" aria-label="How Catalitium curates jobs">
  <div class="rounded-2xl border border-slate-200 bg-white p-4 sm:p-6">
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <div>
        <p class="text-[13px] font-semibold uppercase tracking-wide text-slate-500">Editorial process</p>
        <h3 class="mt-1 text-xl font-semibold text-slate-900">How we curate roles</h3>
        <p class="mt-2 text-sm text-slate-600">
          Every listing is sourced from employer feeds and hand-reviewed for clarity, compensation, location accuracy, and spam signals before it is surfaced in search.
        </p>
        <ul class="mt-3 space-y-2 text-sm text-slate-600">
          <li>Titles and locations get normalized so filters stay reliable.</li>
          <li>Suspicious redirects or missing companies are flagged and removed.</li>
          <li>We rotate fresh roles daily so the feed stays under 7 days old.</li>
        </ul>
      </div>
      <div class="bg-slate-50 rounded-xl border border-slate-200 p-4">
        <p class="text-[13px] font-semibold uppercase tracking-wide text-slate-500">Salary insights</p>
        <h3 class="mt-1 text-lg font-semibold text-slate-900">Transparency promise</h3>
        <p class="mt-2 text-sm text-slate-600">
          Salary tags blend employer provided ranges with Catalitium estimates. We mark ranges with Est. labels, note any missing data, and never inflate compensation to boost clicks.
        </p>
        <div class="mt-3 text-sm text-slate-600 space-y-1.5">
          <p>Currency harmonized to USD/EUR/GBP/CHF to avoid surprises.</p>
          <p>Outliers are reviewed manually before they appear on a card.</p>
          <p>Sponsored employers follow the same disclosure and pay rules.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Explore categories (internal links for crawlability) -->
<section class="mx-auto max-w-4xl mt-6 px-3 sm:px-0" aria-label="Popular categories">
  <div class="rounded-xl border border-slate-200 bg-white p-3 sm:p-4">
    <h3 class="text-sm font-semibold text-slate-800 flex items-center gap-2">
      <svg class="w-4 h-4 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><circle cx="8" cy="6" r="1.2" fill="currentColor"/><circle cx="12" cy="12" r="1.2" fill="currentColor"/><circle cx="16" cy="18" r="1.2" fill="currentColor"/></svg>
      Explore popular job sets
    </h3>
    <div class="mt-2 flex flex-wrap gap-2 sm:gap-3 text-sm">
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', title='ai') }}">
        AI roles
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', title='developer') }}">
        Developer jobs
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', title='remote') }}">
        Remote first
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', title='senior') }}">
        Senior tracks
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', title='>100k') }}">
        100k+ offers
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', country='EU') }}">
        EU market
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', country='US') }}">
        US market
      </a>
      <a class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 hover:bg-slate-100 transition focus-visible:ring-2 focus-visible:ring-brand/50 focus:outline-none" href="{{ url_for('index', country='UK') }}">
        UK market
      </a>
    </div>
  </div>
</section>

<!-- FAQ for long-tail SEO -->
<section class="mx-auto max-w-4xl mt-6 px-3 sm:px-0" aria-label="Job search FAQs">
  <div class="rounded-xl border border-slate-200 bg-white p-3 sm:p-4">
    <h3 class="text-sm font-semibold text-slate-800 flex items-center gap-2">
      <svg class="w-4 h-4 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 4a6 6 0 016 6c0 2-1.1 3.7-3 4.5-.7.3-1 .8-1 1.5v1h-4v-1c0-1.6 1-2.7 2.2-3.3 1-.5 1.8-1.4 1.8-2.7A2.5 2.5 0 0012 7a2.5 2.5 0 00-2.5 2.5H6.5A5.5 5.5 0 0112 4zM10 18h4v2h-4z" fill="currentColor"/></svg>
      Job search FAQs
    </h3>
    <div class="mt-2 space-y-2">

      {% set faqs = [
        ("Are remote AI roles hiring in the EU?",
         "Yes. Remote-friendly AI and ML roles in the EU have grown over 30% year-on-year. Germany, France, the Netherlands, and Spain lead in volume. Use the AI and EU filters together to surface them quickly, and check the salary estimate badge to ensure the range meets your expectations."),
        ("How fresh are the job postings?",
         "Listings are refreshed continuously from employer feeds and normalised daily. Each card shows a posted date pill so you can see exactly how old a listing is. Jobs posted within the last 7 days receive a green New badge. Listings older than 30 days receive a May be filled warning."),
        ("Do roles include salary estimates?",
         "Yes. Most listings show an Est. salary pill derived from Catalitium's location-based salary database, blended with any employer-disclosed range. Senior and lead roles receive an automatic seniority uplift. If a salary range is genuinely unknown we leave the field blank rather than show a misleading estimate."),
        ("What is a ghost job and how do I spot one?",
         "A ghost job is a listing that has been live for 30+ days and is likely already filled, on hold, or was never a real opening. Research suggests up to 40% of active listings at any time are ghost jobs. Catalitium flags every listing older than 30 days with a triangle May be filled badge so you can prioritise your energy on fresh openings."),
        ("What are the highest-paying tech roles right now?",
         "AI and ML engineer roles currently command the highest median salaries on Catalitium — around $150k–$200k USD in the US and EUR 100k–EUR 160k in Europe. Principal and Staff Engineer roles come close, followed by senior full-stack and cloud infrastructure engineers. Use the >100k filter to see only high-compensation listings."),
        ("How do I negotiate a higher salary offer?",
         "Reference Catalitium's salary data when negotiating: show the employer the market range for your role and region. Studies show engineers who negotiate receive 10–20% more than the initial offer on average. If base salary is fixed, push on equity, signing bonus, remote allowance, and learning budget. See our Salary Negotiation Guide in the Resources section."),
        ("Which European cities pay the most for tech?",
         "Zurich and Geneva (Switzerland) consistently top European tech salaries, followed by London, Amsterdam, Berlin, Paris, and Stockholm. Swiss salaries are typically quoted in CHF and translate to EUR 100k–160k for mid-senior roles. London follows at GBP 70k–110k. Berlin and Amsterdam are competitive at EUR 70k–100k for comparable experience levels."),
        ("Can I track my job applications on Catalitium?",
         "Yes. Our free Application Tracker lets you move roles through a Kanban pipeline: Applied, Phone Screen, Interview, Offer, and Closed. It requires no account and stores everything privately in your browser. Hit the Track button on any job card to add it. You can also export your full pipeline as a CSV."),
        ("How does Catalitium differ from LinkedIn Jobs?",
         "LinkedIn optimises for engagement and premium upgrades. Catalitium is built exclusively for tech candidates who want signal over noise: every listing shows salary estimates, ghost jobs are flagged, AI-powered summaries save you time reading descriptions, and the application tracker replaces the black-hole Easy Apply experience. No premium paywall, no recruiter spam."),
      ] %}

      {% for q, a in faqs %}
      <details class="group rounded-lg border border-slate-200 bg-slate-50 px-3 py-2">
        <summary class="flex items-center justify-between cursor-pointer text-sm font-medium text-slate-700 hover:text-blue-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/50 rounded-lg py-1 list-none">
          {{ q }}
          <svg class="w-4 h-4 transition-transform group-open:rotate-180 text-slate-500 flex-shrink-0 ml-2 motion-safe:transition-transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
        </summary>
        <p class="mt-1.5 pb-1 text-sm text-slate-600 leading-relaxed">{{ a }}</p>
      </details>
      {% endfor %}

    </div>
  </div>
</section>

{% set has_search_ctx = (title_q or country_q or salary_band) %}
<section id="saved-search-sticky"
         class="fixed inset-x-0 bottom-0 z-40 border-t border-slate-200 bg-white/95 backdrop-blur px-3 py-2 shadow-[0_-6px_20px_rgba(15,23,42,0.08)] {% if not has_search_ctx %}hidden{% endif %}">
  <div class="mx-auto max-w-4xl flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
    <p class="text-sm text-slate-700">
      Save this search and get a weekly digest of top matches{% if salary_band %} around {{ salary_band }}{% endif %}.
      <span class="text-xs text-slate-500">Includes salary signal. No spam.</span>
    </p>
    <button type="button"
            class="inline-flex items-center justify-center rounded-xl bg-brand text-white px-4 py-2 text-sm font-semibold hover:opacity-90"
            data-open-subscribe="sticky_save_search"
            data-subscribe-title="{{ title_q or '' }}"
            data-subscribe-country="{{ country_q or '' }}"
            data-subscribe-salary="{{ salary_band or '' }}">
      Save Search + Digest
    </button>
  </div>
</section>
{% if has_search_ctx %}
<div class="h-20" aria-hidden="true"></div>
{% endif %}

<!-- Pagination -->
{% if pagination and (pagination.has_prev or pagination.has_next) %}
<nav class="mx-auto max-w-4xl mt-4 flex items-center justify-between text-sm"
     role="navigation" aria-label="Pagination">
  <a rel="prev" aria-disabled="{{ 'false' if pagination.has_prev else 'true' }}" tabindex="{{ '0' if pagination.has_prev else '-1' }}" class="px-3 py-2 rounded-lg border border-slate-200 hover:border-brand {{ '' if pagination.has_prev else 'pointer-events-none opacity-50' }}"
     href="{{ pagination.prev_url or '#' }}">? Prev</a>
  <span class="text-slate-500">
    Page {{ pagination.page }} of {{ pagination.pages }}  {{ pagination.total }} total
  </span>
  <a rel="next" aria-disabled="{{ 'false' if pagination.has_next else 'true' }}" tabindex="{{ '0' if pagination.has_next else '-1' }}" class="px-3 py-2 rounded-lg border border-slate-200 hover:border-brand {{ '' if pagination.has_next else 'pointer-events-none opacity-50' }}"
     href="{{ pagination.next_url or '#' }}">Next</a>
</nav>
{% endif %}

<!-- Subscribe dialog is defined globally in base.html -->
{% endblock %}

{% block body_extra %}
<script defer src="{{ url_for('static', filename='js/ai_summary.js') }}"></script>
<!-- Structured Data for Job Search -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "{{ url_for('index', _external=True) }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ url_for('index', _external=True) }}?title={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>
{% if results and results|length > 0 %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "itemListElement": [
    {% for j in results %}
    {
      "@type": "ListItem",
      "position": {{ loop.index }},
      "item": {
        "@type": "JobPosting",
        "title": "{{ j.title|e }}",
        "description": "{{ j.description|truncate(200, True)|e }}",
        "datePosted": "{{ j.date }}",
        "employmentType": "FULL_TIME",
        "hiringOrganization": {
          "@type": "Organization",
          "name": "{{ j.company|e if j.company else 'Company' }}"
        },
        "jobLocation": {
          "@type": "Place",
          "address": {
            "@type": "PostalAddress",
            "addressLocality": "{{ j.location|e }}"
          }
        }{% if j.estimated_salary_range_compact %},
        "estimatedSalary": {
          "@type": "MonetaryAmount",
          "currency": "{{ j.median_salary_currency }}",
          "value": {
            "@type": "QuantitativeValue",
            "minValue": {{ j.salary_min if j.salary_min else "null" }},
            "maxValue": {{ j.salary_max if j.salary_max else "null" }},
            "unitText": "YEAR"
          }
        }{% endif %}
      }
    }{{ "," if not loop.last }}
    {% endfor %}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Are remote AI roles hiring in the EU?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, our EU feed includes remote-friendly AI roles. Use the AI and EU filters together to surface them quickly."
      }
    },
    {
      "@type": "Question",
      "name": "How fresh are the postings?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "We refresh listings regularly and tag new arrivals. Look for the \u201cNew\u201d badge and the posted date pill on each card."
      }
    },
    {
      "@type": "Question",
      "name": "Do roles include salary estimates?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Many cards show an Est. salary pill. If a range is missing, we flag it so you know before clicking through."
      }
    }
  ]
}
</script>
{% endif %}

<script>
(() => {
  const form = document.getElementById('search');
  const results = document.getElementById('results');
  const skeletons = document.getElementById('results-skeletons');
  const chips = document.querySelectorAll('[data-filter-chip]');
  const titleInput = document.getElementById('q');
  const countryInput = document.getElementById('loc');

  const showSkeleton = () => {
    if (skeletons && results) {
      skeletons.classList.remove('hidden');
      results.classList.add('opacity-60');
    }
  };

  if (form) {
    form.addEventListener('submit', () => {
      try {
        localStorage.setItem('last_title', titleInput?.value || '');
        localStorage.setItem('last_country', countryInput?.value || '');
        localStorage.setItem('has_searched', '1');
      } catch (_) {}
      showSkeleton();
    });
  }

  chips.forEach(chip => {
    chip.addEventListener('click', () => {
      try {
        localStorage.setItem('last_title', titleInput?.value || '');
        localStorage.setItem('last_country', countryInput?.value || '');
        localStorage.setItem('has_searched', '1');
      } catch (_) {}
      showSkeleton();
    });
  });

  // Restore last search on landing if fields are empty
  try {
    const hasSearched = localStorage.getItem('has_searched') === '1';
    if (hasSearched) {
      const savedTitle = localStorage.getItem('last_title') || '';
      const savedCountry = localStorage.getItem('last_country') || '';
      if (titleInput && !titleInput.value && savedTitle) titleInput.value = savedTitle;
      if (countryInput && !countryInput.value && savedCountry) countryInput.value = savedCountry;
    }
  } catch (_) {}
})();
</script>
{% endblock %}
</attachment>
